%%% ----------------------------------------------------------------------
%%% LaTeX-Präambel
%%% Hier werden alle Pakete geladen und Einstellungen vorgenommen.
%%% ----------------------------------------------------------------------

%%% 1. Basiskonfiguration & Hilfsbefehle
%%% ----------------------------------------------------------------------
\input{preambel/preambel-commands}

%%% Spracheinstellungen (Babel)
\ifthenelse{\equal{\lang}{ngerman}}
  {\usepackage[ngerman]{babel}}
  {\usepackage[english]{babel}}

%%% Farben
\usepackage[table]{xcolor}

%%% Bilder einbinden
\usepackage{graphicx}

%%% Querformat für einzelne Seiten
\usepackage{pdflscape}

%%% Rechnen mit LaTeX (wird oft intern benötigt)
\usepackage{calc}


%%% 2. Text & Typografie
%%% ----------------------------------------------------------------------

%%% Schrift-Encoding und Symbole
\usepackage[T1]{fontenc}
\usepackage{textcomp}

%%% Schriftarten laden (ausgelagert)
\input{preambel/Fonts}

%%% Zeilenabstand (1,5-fach)
\usepackage{setspace}
\onehalfspacing

%%% Mikrotypografie (Optischer Randausgleich etc.)
\usepackage[
   expansion=true,
   protrusion=true,
   tracking=true,
   kerning=true
]{microtype}
% Deaktiviere Protrusion für deutsche Anführungszeichen
\microtypesetup{activate={true,nocompatibility},final,tracking=true,kerning=true}

%%% Besserer Flattersatz (Linksbündig)
\usepackage{ragged2e}

%%% Intelligente "..." (\dots)
\usepackage{ellipsis}

%%% Textauszeichnungen (Unterstreichen, Durchstreichen, Sperren)
\usepackage[normalem]{ulem}
\usepackage{soul}

%%% URLs korrekt umbrechen
\usepackage{xurl}

%%% Anführungszeichen (passend zur Sprache)
\usepackage[babel, german=quotes, english=british, french=guillemets]{csquotes}
\SetBlockThreshold{2} % Ab 2 Zeilen wird ein Zitat als Block gesetzt


%%% 3. Layout & Seitenränder
%%% ----------------------------------------------------------------------

%%% Seitenränder einstellen (Geometry)
\usepackage{geometry}
\geometry{
   a4paper,
   portrait,
   ignoreall,      % Kopf-/Fußzeilen zählen nicht zum Rand
   heightrounded,  % Textblockhöhe an Zeilenraster anpassen
   hmargin={3.5cm, 2.5cm}, % Links / Rechts
   vmargin={3cm, 3cm},     % Oben / Unten
   bindingoffset=5mm,      % Bindekorrektur
   marginparwidth=0pt,
   twoside,
}

%%% Kopf- und Fußzeilen (KOMA-Script)
\usepackage[
   automark,
   pagestyleset=KOMA-Script,
   markcase=ignoreuppercase,
]{scrlayer-scrpage}

% Standard-Stile löschen
\clearmainofpairofpagestyles
\clearplainofpairofpagestyles

% Einstellung: Oben außen Kapitel/Sektion, Unten außen Seitenzahl
\ohead{\headmark}
\ofoot[\pagemark]{\pagemark}

% Linie unter der Kopfzeile
\KOMAoptions{headsepline=.4pt}
\addtokomafont{headsepline}{\color{black}}

% Breite von Kopf/Fuß an Text anpassen
\KOMAoptions{headwidth=text:0pt, footwidth=text:0pt}

% Schriftart für Kopf/Fuß
\setkomafont{pageheadfoot}{\normalfont\normalcolor\small\sffamily}
\setkomafont{pagenumber}{\bfseries\sffamily}

%%% Fußnoten
\usepackage[bottom, stable, perpage, multiple]{footmisc}
\deffootnote{1.5em}{1em}{\makebox[1.5em][l]{\thefootnotemark}} % Layout
\addtolength{\skip\footins}{\baselineskip} % Abstand Text <-> Fußnote

%%% Hurenkinder und Schusterjungen vermeiden (Einzelne Zeilen am Seitenanfang/-ende)
\clubpenalty = 10000
\widowpenalty = 10000
\displaywidowpenalty = 10000


%%% 4. Tabellen & Abbildungen
%%% ----------------------------------------------------------------------

%%% Tabellen-Optimierung
\usepackage{booktabs}  % Schöne Linien (\toprule, \midrule, \bottomrule)
\usepackage{multirow}  % Zellen über mehrere Zeilen
\usepackage{dcolumn}   % Ausrichtung an Komma/Punkt
\usepackage{ltxtable}  % Tabellen über mehrere Seiten (Longtable + Tabularx)

%%% Abbildungen & Floats
\usepackage{float}     % Option [H] für feste Platzierung
\usepackage{flafter}   % Floats erst nach ihrer Referenz im Text
\usepackage[section]{placeins} % Floats bleiben in ihrer Section

%%% Unterabbildungen (Bild a, Bild b)
\usepackage{subcaption}

%%% Textumflossene Bilder
\usepackage{wrapfig}
\setlength{\intextsep}{0.5\baselineskip}

%%% Beschriftungen (Captions)
\usepackage{caption}
\captionsetup{
   margin = 10pt,
   font = {small,rm},
   labelfont = {small,bf},
   format = plain,
   indention = 0em,
   labelsep = colon,
   justification = RaggedRight,
   singlelinecheck = true,
   position = bottom
}
% Workaround für Warnungen
\DeclareCaptionOption{parskip}[]{}
\DeclareCaptionOption{parindent}[]{}

% Caption auch außerhalb von Floats erlauben
\usepackage{capt-of}

%%% Farbige Boxen (für Infoboxen etc.)
\usepackage[most]{tcolorbox}


%%% 5. Mathematik & Wissenschaft
%%% ----------------------------------------------------------------------

%%% Basispakete
\usepackage{amsmath}
\usepackage[fixamsmath,disallowspaces]{mathtools}

%%% ISO-Konforme Mathematik (Griechische Großbuchstaben kursiv etc.)
\usepackage{fixmath}

%%% Komma als Dezimaltrennzeichen im Mathe-Modus
\usepackage{icomma}

%%% Einheiten und Zahlen formatieren (WICHTIG!)
\usepackage[locale=DE]{siunitx}

%%% Zusätzliche Mathe-Symbole und Werkzeuge
\usepackage{braket}    % Bra-Ket Schreibweise
\usepackage{cancel}    % Durchstreichen
\usepackage{empheq}    % Hervorgehobene Gleichungen
\usepackage[Symbolsmallscale]{upgreek}
\usepackage[upmu]{gensymb}

%%% Epsilon-Symbol anpassen (gewohntes Aussehen)
\let\ORGvarepsilon=\varepsilon
\let\varepsilon=\epsilon
\let\epsilon=\ORGvarepsilon


%%% 6. Verzeichnisse & Referenzen
%%% ----------------------------------------------------------------------

%%% Literaturverzeichnis (BibLaTeX mit Biber)
\usepackage[style=alphabetic, backend=biber]{biblatex}
\addbibresource{bib/BibtexDatabase.bib}

%%% Index, Abkürzungen, Nomenklatur
\usepackage{makeidx}
\usepackage[german]{nomencl}
\usepackage[printonlyused]{acronym}

%%% Intelligente Querverweise ("siehe Seite X")
\usepackage[ngerman]{varioref}

%%% PDF-Links und Bookmarks (Hyperref)
\usepackage[
   hidelinks,               % Keine bunten Rahmen
   linktocpage=true,        % Seitenzahlen im TOC verlinken
   bookmarks=true,          % Lesezeichen im PDF
   bookmarksopen=true,
   bookmarksnumbered=true,
   plainpages=false,        % Verhindert "duplicate page identifiers"
   pdfpagelabels=true,      % Korrekte Seitennummerierung (römisch/arabisch)
   pdftitle={},
   pdfauthor={},
]{hyperref}

%%% Links springen zum Bild, nicht zur Caption
\usepackage[figure,table]{hypcap}


%%% 7. Code & Listings
%%% ----------------------------------------------------------------------

%%% Quellcode-Darstellung
\usepackage{listings}
\usepackage{upquote} % Korrekte Anführungszeichen im Code

% Farben für Code
\definecolor{keywordblue}{RGB}{0,0,0}
\definecolor{stringred}{RGB}{0,0,0}

\lstset{
  basicstyle={\footnotesize\ttfamily},
	breaklines=true,
	extendedchars=true,
	frame=b,
	framexbottommargin=4pt,
	framexleftmargin=17pt,
	framexrightmargin=5pt,
	keywordstyle={\color{keywordblue}},
	numbers=left,
	numbersep=5pt,
	numberstyle={\tiny},
	showspaces=false,
	showstringspaces=false,
	showtabs=false,
	stringstyle={\color{stringred}\ttfamily},
	tabsize=2
}
\lstloadlanguages{HTML, PHP, XML, SQL, Java, Python}


%%% 8. Sonstiges
%%% ----------------------------------------------------------------------

%%% Listen (Aufzählungen) anpassen
\usepackage{enumitem}

%%% Mehrspaltiger Text
\usepackage{multicol}

%%% Externe PDFs einbinden
\usepackage{pdfpages}

%%% Randnotizen
\usepackage{marginnote}

%%% TODO-Notizen
\setlength{\marginparwidth}{2cm}
\usepackage{todonotes}


%%% 9. Farben & Design
%%% ----------------------------------------------------------------------

% Farben definieren
\definecolor{sectioncolor}{RGB}{0, 0, 0}
\definecolor{textcolor}{RGB}{0, 0, 0}
\definecolor{shadecolor}{gray}{0.90}

% PDF-Link-Farben (werden bei hidelinks ignoriert, aber gut zu haben)
\definecolor{pdfurlcolor}{rgb}{0,0,0.6}
\definecolor{pdffilecolor}{rgb}{0.7,0,0}
\definecolor{pdflinkcolor}{rgb}{0,0,0.6}
\definecolor{pdfcitecolor}{rgb}{0,0,0.6}

% Schriftart für Überschriften (Sans-Serif)
\newcommand\SectionFontStyle{\sffamily}
\setkomafont{sectioning}{\SectionFontStyle}
\setkomafont{chapter}{\huge\SectionFontStyle}
\addtokomafont{sectioning}{\color{sectioncolor}}

%%% 10. Auszuführende Befehle
%%% ----------------------------------------------------------------------
\IfDefined{makeindex}{\makeindex}
\IfDefined{makenomenclature}{\makenomenclature}
\IfPackageLoaded{minitoc}{\IfElseUnDefined{chapter}{\dosecttoc}{\dominitoc}}
\renewcommand{\nomname}{Abkürzungsverzeichnis}

\listfiles
